<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéáDiwali Spin & Win Grand Festive Offer üéÅ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a001a 0%, #1a0033 50%, #2a0044 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            color: #fff;
            /* Ads ke liye space */
            padding-top: 50px;
            padding-bottom: 50px;
        }

        /* --- Ad Container Styles --- */
        .ad-container {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            width: 320px;
            height: 50px;
            z-index: 99; /* Modals ke neeche */
        }
        .ad-top {
            top: 0;
        }
        .ad-bottom {
            bottom: 0;
        }


        /* Simplified LED Light Effects */
        .led-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .led-light {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
        }

        .led-red {
            background: #ff0000;
            box-shadow: 0 0 5px #ff0000;
            animation: pulse-red 3s infinite alternate;
        }

        .led-green {
            background: #00ff00;
            box-shadow: 0 0 5px #00ff00;
            animation: pulse-green 3.5s infinite alternate;
        }

        .led-yellow {
            background: #ffff00;
            box-shadow: 0 0 5px #ffff00;
            animation: pulse-yellow 2.8s infinite alternate;
        }

        @keyframes pulse-red {
            0% { opacity: 0.4; }
            100% { opacity: 1; }
        }

        @keyframes pulse-green {
            0% { opacity: 0.4; }
            100% { opacity: 1; }
        }

        @keyframes pulse-yellow {
            0% { opacity: 0.4; }
            100% { opacity: 1; }
        }

        /* Simplified Diya */
        .diya {
            position: absolute;
            width: 40px;
            height: 40px;
            z-index: 1;
        }

        .diya-base {
            width: 40px;
            height: 15px;
            background: linear-gradient(to bottom, #d4a574, #8b6239);
            border-radius: 50% 50% 10% 10%;
            position: relative;
        }

        .diya-flame {
            position: absolute;
            top: -15px;
            left: 10px;
            width: 20px;
            height: 25px;
            background: radial-gradient(ellipse at bottom, #fff 0%, #ffeb3b 20%, #ff9800 60%, #ff5722 100%);
            border-radius: 50% 50% 20% 20% / 60% 60% 40% 40%;
            box-shadow: 0 0 10px #ff9800;
            animation: flicker 2s infinite alternate;
        }

        @keyframes flicker {
            0% { transform: scale(0.95); opacity: 0.9; }
            100% { transform: scale(1.05); opacity: 1; }
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 100px); /* Ads ke liye height adjust */
            padding: 20px;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffcc00, #ff9900, #ff6600);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #ffcc00;
        }

        /* Wheel Container */
        .wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px auto;
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(255, 204, 0, 0.7);
            transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            background-image: url('assets/wheel.png');
            background-size: cover;
            background-position: center;
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, #ffcc00 0%, #ff9900 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.8);
            z-index: 10;
            cursor: pointer;
        }

        .wheel-center::before {
            content: 'ü™î';
            font-size: 30px;
        }

        .wheel-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid #ff6600;
            z-index: 11;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(45deg, #ff9900, #ff6600);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin: 20px 10px;
            box-shadow: 0 5px 15px rgba(255, 102, 0, 0.4);
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 102, 0, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-whatsapp {
            background: linear-gradient(45deg, #25D366, #128C7E);
        }

        .btn-telegram {
            background: linear-gradient(45deg, #0088CC, #005F8F);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #330066 0%, #4d0099 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            text-align: center;
            box-shadow: 0 0 30px rgba(255, 204, 0, 0.5);
            position: relative;
            border: 2px solid rgba(255, 204, 0, 0.3);
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: #ffcc00;
            background: none;
            border: none;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ffcc00, #ff9900);
            border-radius: 15px;
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Form */
        .form-group {
            margin: 20px 0;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #ffcc00;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 204, 0, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #ffcc00;
            background: rgba(255, 255, 255, 0.15);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Share Status Card */
        .share-status-card {
            background: rgba(255, 204, 0, 0.1);
            border: 1px solid rgba(255, 204, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            width: 100%;
            max-width: 400px;
        }

        .share-status-title {
            color: #ffcc00;
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .share-count-display {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .share-count-item {
            text-align: center;
        }

        .share-count-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffcc00;
        }

        .share-count-label {
            font-size: 0.9rem;
            color: #fff;
        }

        .share-status-text {
            color: #fff;
            font-size: 1rem;
            margin: 15px 0;
        }

        /* Thank You Screen */
        .thank-you-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            text-align: center;
        }

        .thank-you-card {
            background: linear-gradient(135deg, #330066 0%, #4d0099 100%);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 0 30px rgba(255, 204, 0, 0.5);
            border: 2px solid rgba(255, 204, 0, 0.3);
        }

        .thank-you-title {
            font-size: 2rem;
            color: #ffcc00;
            margin-bottom: 20px;
        }

        .thank-you-message {
            font-size: 1.2rem;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .wheel-container {
                width: 250px;
                height: 250px;
            }
            
            .btn {
                padding: 12px 25px;
                font-size: 1rem;
                margin: 10px 5px;
            }
            
            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Top Ad Container -->
    <div class="ad-container ad-top">
        <script type="text/javascript">
	atOptions = {
		'key' : '292f2756d6f11741263033e468512ae7',
		'format' : 'iframe',
		'height' : 50,
		'width' : 320,
		'params' : {}
	};
</script>
<script type="text/javascript" src="//www.highperformanceformat.com/292f2756d6f11741263033e468512ae7/invoke.js"></script>
    </div>

    <!-- LED Lights -->
    <div class="led-container" id="ledContainer"></div>
    
    <!-- Diyas -->
    <div id="diyasContainer"></div>

    <!-- Main Container -->
    <div class="container" id="mainContainer">
        <header>
            <h1>üéÜ Diwali Spin & Win Grand Festive Offer üéÅ</h1>
            <p class="subtitle">Spin the wheel and win amazing prizes!</p>
        </header>

        <main>
            <div class="wheel-container">
                <div class="wheel-pointer"></div>
                <div class="wheel" id="wheel">
                    <!-- Wheel image will be loaded from assets/wheel.png -->
                </div>
                <div class="wheel-center" id="spinBtn"></div>
            </div>
            
            <button class="btn" id="spinNowBtn">SPIN NOW</button>
            
            <!-- Share Status Card -->
            <div class="share-status-card" id="shareStatusCard" style="display: none;">
                <div class="share-status-title">‡§∂‡•á‡§Ø‡§∞‡§ø‡§Ç‡§ó ‡§™‡•ç‡§∞‡§ó‡§§‡§ø</div>
                <div class="share-count-display">
                    <div class="share-count-item">
                        <div class="share-count-number" id="currentShares">0</div>
                        <div class="share-count-label">‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§ø‡§è</div>
                    </div>
                    <div class="share-count-item">
                        <div class="share-count-number" id="totalShares">10</div>
                        <div class="share-count-label">‡§ï‡•Å‡§≤ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï</div>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="share-status-text" id="shareStatusText">
                    10 ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•ã ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§™‡§®‡§æ ‡§™‡•Å‡§∞‡§∏‡•ç‡§ï‡§æ‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
                </div>
                <div id="shareButtonsContainer" style="margin-top: 20px;">
                    <button class="btn btn-whatsapp" id="shareWhatsAppBtn">
                        <span>üì± Share on WhatsApp</span>
                    </button>
                    <button class="btn btn-telegram" id="shareTelegramBtn">
                        <span>‚úàÔ∏è Share on Telegram</span>
                    </button>
                </div>
            </div>
        </main>

        <footer>
            <p>Made with ‚ù§Ô∏è for Diwali 2025</p>
        </footer>
    </div>

    <!-- Thank You Container -->
    <div class="thank-you-container" id="thankYouContainer">
        <div class="thank-you-card">
            <h2 class="thank-you-title">üéâ ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! üéâ</h2>
            <p class="thank-you-message">
                ‡§Ü‡§™‡§ï‡§æ ‡§™‡•Å‡§∞‡§∏‡•ç‡§ï‡§æ‡§∞ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ï‡•ç‡§≤‡•á‡§Æ ‡§ï‡§∞ ‡§≤‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à!<br><br>
                ‡§Ü‡§™‡§ï‡§æ ‡§™‡•Å‡§∞‡§∏‡•ç‡§ï‡§æ‡§∞ ‡§ï‡•Å‡§õ ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§ø‡§è ‡§ó‡§è ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§∞ ‡§≠‡•á‡§ú ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§è‡§ó‡§æ‡•§<br><br>
                ‡§π‡§Æ‡§æ‡§∞‡•á ‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞‡•Ä ‡§ë‡§´‡§∞ ‡§ï‡§æ ‡§π‡§ø‡§∏‡•ç‡§∏‡§æ ‡§¨‡§®‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü‡§™‡§ï‡§æ ‡§¨‡§π‡•Å‡§§-‡§¨‡§π‡•Å‡§§ ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!
            </p>
            <button class="btn" id="backToHomeBtn">‡§π‡•ã‡§Æ ‡§™‡§∞ ‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç</button>
        </div>
    </div>

    <!-- Result Modal -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <button class="close-btn" id="closeModal">&times;</button>
            <h2 id="resultTitle">üéâ Congratulations! You Won [Prize Name] üéÅ</h2>
            <p id="resultMessage">You've won an amazing prize! Share with friends to claim.</p>
            <div id="confettiContainer"></div>
            <div style="margin-top: 20px;">
                <button class="btn btn-whatsapp" id="modalShareWhatsAppBtn">
                    <span>üì± Share on WhatsApp</span>
                </button>
                <button class="btn btn-telegram" id="modalShareTelegramBtn">
                    <span>‚úàÔ∏è Share on Telegram</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Claim Form Modal -->
    <div class="modal" id="claimFormModal">
        <div class="modal-content">
            <h2>üéÅ Almost There! Verify to Claim Your Reward üéÅ</h2>
            <p style="color: #ffcc00; margin-bottom: 20px;">
                ‡§Ü‡§™‡§ï‡§æ ‡§™‡•Å‡§∞‡§∏‡•ç‡§ï‡§æ‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•Ä‡§ö‡•á ‡§¶‡•Ä ‡§ó‡§à ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç
            </p>
            <form id="claimForm">
                <div class="form-group">
                    <label for="userName">üë§ ‡§Ö‡§™‡§®‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</label>
                    <input type="text" id="userName" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ" required>
                </div>
                <div class="form-group">
                    <label for="userMobile">üì± ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç</label>
                    <input type="tel" id="userMobile" placeholder="‡§Ü‡§™‡§ï‡§æ ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞" pattern="[0-9]{10}" required>
                </div>
                <button type="submit" class="btn">
                    üéÅ Claim Reward
                </button>
            </form>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="bgm" loop>
        <source src="assets/bgm.mp3" type="audio/mpeg">
    </audio>
    <audio id="spinSound">
        <source src="assets/spin.mp3" type="audio/mpeg">
    </audio>
    <audio id="winSound">
        <source src="assets/win.mp3" type="audio/mpeg">
    </audio>

    <!-- Bottom Ad Container -->
    <div class="ad-container ad-bottom">
        <script type="text/javascript">
            atOptions = {
                'key' : 'a9f34891382c8a3572b2a0516635b806',
                'format' : 'iframe',
                'height' : 50,
                'width' : 320,
                'params' : {}
            };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/a9f34891382c8a3572b2a0516635b806/invoke.js"></script>
    </div>


    <script>
        // Initialize variables
        let isSpinning = false;
        let currentRotation = 0;
        let audioEnabled = false;
        let currentPrize = '';
        let currentSharePlatform = '';

        // Prize list
        const prizes = [
            { name: 'Flat ‚Çπ100 OFF', color: '#FF6B6B' },
            { name: 'Buy 1 Get 1 Free', color: '#4ECDC4' },
            { name: 'Free Shipping', color: '#45B7D1' },
            { name: 'Extra 20% OFF', color: '#96CEB4' },
            { name: '‚Çπ500 Cash Voucher', color: '#FFEAA7' },
            { name: 'Apple AirPods Pro', color: '#DDA0DD' },
            { name: 'iPhone 17 Pro Max', color: '#FF7675' },
            { name: 'Diwali Gift Hamper', color: '#FD79A8' }
        ];

        // Initialize app state from localStorage
        function initializeAppState() {
            const hasSpun = localStorage.getItem('hasSpun') === 'true';
            const savedPrize = localStorage.getItem('currentPrize');
            const shareCount = parseInt(localStorage.getItem('shareCount') || '0');
            const hasClaimed = localStorage.getItem('hasClaimed') === 'true';
            
            updateShareCountDisplay(shareCount);
            
            if (hasClaimed) {
                document.getElementById('mainContainer').style.display = 'none';
                document.getElementById('thankYouContainer').style.display = 'flex';
                return;
            }
            
            if (hasSpun && savedPrize) {
                currentPrize = savedPrize;
                document.getElementById('spinNowBtn').disabled = true;
                document.getElementById('spinNowBtn').textContent = 'Already Spun';
                document.getElementById('shareStatusCard').style.display = 'block';
                
                if (shareCount >= 10) {
                    document.getElementById('claimFormModal').style.display = 'flex';
                }
            }
        }

        // Update share count display
        function updateShareCountDisplay(count) {
            document.getElementById('currentShares').textContent = count;
            document.getElementById('progressBar').style.width = `${(count / 10) * 100}%`;
            
            if (count < 10) {
                document.getElementById('shareStatusText').textContent = 
                    `${10 - count} ‡§î‡§∞ ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•ã ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§Ö‡§™‡§®‡§æ ‡§™‡•Å‡§∞‡§∏‡•ç‡§ï‡§æ‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç`;
            } else {
                document.getElementById('shareStatusText').textContent = 
                    '‚úÖ ‡§∏‡§≠‡•Ä ‡§∂‡•á‡§Ø‡§∞ ‡§™‡•Ç‡§∞‡•ç‡§£! ‡§Ö‡§™‡§®‡§æ ‡§™‡•Å‡§∞‡§∏‡•ç‡§ï‡§æ‡§∞ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç';
            }
        }

        // Save app state to localStorage
        function saveAppState() {
            localStorage.setItem('hasSpun', 'true');
            localStorage.setItem('currentPrize', currentPrize);
            localStorage.setItem('shareCount', document.getElementById('currentShares').textContent);
        }

        // Create simplified LED lights
        function createLEDLights() {
            const ledContainer = document.getElementById('ledContainer');
            const colors = ['led-red', 'led-green', 'led-yellow'];
            for (let i = 0; i < 20; i++) {
                const led = document.createElement('div');
                led.className = `led-light ${colors[Math.floor(Math.random() * colors.length)]}`;
                led.style.left = `${Math.random() * 100}%`;
                led.style.top = `${Math.random() * 100}%`;
                ledContainer.appendChild(led);
            }
        }

        // Create simplified diyas
        function createDiyas() {
            const diyasContainer = document.getElementById('diyasContainer');
            const positions = [
                { top: '10%', left: '5%' },
                { top: '10%', right: '5%' },
                { top: '80%', left: '5%' },
                { top: '80%', right: '5%' }
            ];
            positions.forEach(pos => {
                const diya = document.createElement('div');
                diya.className = 'diya';
                Object.keys(pos).forEach(key => { diya.style[key] = pos[key]; });
                const diyaBase = document.createElement('div');
                diyaBase.className = 'diya-base';
                const diyaFlame = document.createElement('div');
                diyaFlame.className = 'diya-flame';
                diyaBase.appendChild(diyaFlame);
                diya.appendChild(diyaBase);
                diyasContainer.appendChild(diya);
            });
        }

        // Create simplified confetti
        function createConfetti() {
            const container = document.getElementById('confettiContainer');
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    Object.assign(confetti.style, {
                        position: 'absolute', width: '10px', height: '10px',
                        background: `hsl(${Math.random() * 360}, 100%, 70%)`,
                        left: `${Math.random() * 100}%`, top: '-10px',
                        opacity: Math.random(), transform: `rotate(${Math.random() * 360}deg)`,
                        transition: 'all 2s linear'
                    });
                    container.appendChild(confetti);
                    setTimeout(() => {
                        confetti.style.top = '100%';
                        confetti.style.opacity = '0';
                        confetti.style.transform = `rotate(${Math.random() * 720}deg)`;
                    }, 100);
                    setTimeout(() => confetti.remove(), 2100);
                }, i * 50);
            }
        }

        // Spin the wheel
        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;
            document.getElementById('spinNowBtn').disabled = true;
            document.getElementById('spinSound').play();
            const spins = 5 + Math.random() * 2;
            const segmentAngle = 360 / prizes.length;
            const randomSegment = Math.floor(Math.random() * prizes.length);
            const totalRotation = spins * 360 + randomSegment * segmentAngle + (Math.random() * segmentAngle);
            currentRotation += totalRotation;
            document.getElementById('wheel').style.transform = `rotate(${currentRotation}deg)`;
            setTimeout(() => {
                isSpinning = false;
                document.getElementById('spinNowBtn').textContent = 'Already Spun';
                const prizeIndex = Math.floor(((360 - (currentRotation % 360) + (segmentAngle / 2)) % 360) / segmentAngle);
                currentPrize = prizes[prizeIndex].name;
                document.getElementById('winSound').play();
                const popupAdScript = document.createElement('script');
                popupAdScript.type = 'text/javascript';
                popupAdScript.src = '//pl27855565.effectivegatecpm.com/1a/e0/b0/1ae0b0ab4412e106a446b802d5c55140.js';
                document.body.appendChild(popupAdScript);
                saveAppState();
                showResult(currentPrize);
            }, 5000);
        }

        // Show result modal
        function showResult(prize) {
            document.getElementById('resultTitle').textContent = `üéâ Congratulations! You Won ${prize} üéÅ`;
            document.getElementById('resultModal').style.display = 'flex';
            createConfetti();
        }

        // Share functionality
        function shareOnWhatsApp() {
            const shareUrl = window.location.href;
            const shareText = `üéÜ Diwali Spin & Win üéÜ\n\n‡§Æ‡•à‡§Ç‡§®‡•á ‡§ú‡•Ä‡§§‡§æ ‡§π‡•à ${currentPrize}! ‡§Ü‡§™ ‡§≠‡•Ä ‡§∏‡•ç‡§™‡§ø‡§® ‡§ï‡§∞‡§ï‡•á ‡§™‡•ç‡§∞‡§æ‡§á‡§ú ‡§ú‡•Ä‡§§‡•á‡§Ç!\n\n${shareUrl}`;
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(shareText)}`;
            window.open(whatsappUrl, '_blank');
            incrementShareCount();
            document.getElementById('resultModal').style.display = 'none';
            // BUG FIX: Ensure share card is visible after closing modal
            document.getElementById('shareStatusCard').style.display = 'block';
        }

        function shareOnTelegram() {
            const shareUrl = window.location.href;
            const shareText = `üéÜ Diwali Spin & Win üéÜ\n\n‡§Æ‡•à‡§Ç‡§®‡•á ‡§ú‡•Ä‡§§‡§æ ‡§π‡•à ${currentPrize}! ‡§Ü‡§™ ‡§≠‡•Ä ‡§∏‡•ç‡§™‡§ø‡§® ‡§ï‡§∞‡§ï‡•á ‡§™‡•ç‡§∞‡§æ‡§á‡§ú ‡§ú‡•Ä‡§§‡•á‡§Ç!\n\n${shareUrl}`;
            const telegramUrl = `https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareText)}`;
            window.open(telegramUrl, '_blank');
            incrementShareCount();
            document.getElementById('resultModal').style.display = 'none';
            // BUG FIX: Ensure share card is visible after closing modal
            document.getElementById('shareStatusCard').style.display = 'block';
        }

        // Increment share count
        function incrementShareCount() {
            let count = parseInt(localStorage.getItem('shareCount') || '0');
            count = Math.min(count + 1, 10);
            localStorage.setItem('shareCount', count.toString());
            updateShareCountDisplay(count);
            if (count >= 10) {
                setTimeout(() => {
                    document.getElementById('claimFormModal').style.display = 'flex';
                }, 1000);
            }
        }

        // Initialize audio with autoplay
        function initializeAudio() {
            const bgm = document.getElementById('bgm');
            bgm.volume = 0.3;
            const playPromise = bgm.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log('Autoplay was prevented, will start on user interaction.');
                    const initAudioOnInteraction = () => {
                        bgm.play().then(() => { audioEnabled = true; }).catch(e => {});
                    };
                    document.addEventListener('click', initAudioOnInteraction, { once: true });
                    document.addEventListener('touchstart', initAudioOnInteraction, { once: true });
                });
            }
        }

        // Event listeners
        document.getElementById('spinNowBtn').addEventListener('click', spinWheel);
        document.getElementById('spinBtn').addEventListener('click', spinWheel);
        document.getElementById('closeModal').addEventListener('click', () => { document.getElementById('resultModal').style.display = 'none'; });
        document.getElementById('shareWhatsAppBtn').addEventListener('click', shareOnWhatsApp);
        document.getElementById('shareTelegramBtn').addEventListener('click', shareOnTelegram);
        document.getElementById('modalShareWhatsAppBtn').addEventListener('click', shareOnWhatsApp);
        document.getElementById('modalShareTelegramBtn').addEventListener('click', shareOnTelegram);
        
        document.getElementById('claimForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const mobile = document.getElementById('userMobile').value;
            if (mobile.length !== 10 || !/^[0-9]+$/.test(mobile)) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ 10 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç');
                return;
            }
            localStorage.setItem('hasClaimed', 'true');
            window.location.href = 'https://linkpays.in/KbuJT';
        });

        document.getElementById('backToHomeBtn').addEventListener('click', () => {
            localStorage.clear();
            window.location.reload();
        });

        // Initialize
        window.addEventListener('load', () => {
            initializeAppState();
            createLEDLights();
            createDiyas();
            initializeAudio();
        });
    </script>
</body>
</html>